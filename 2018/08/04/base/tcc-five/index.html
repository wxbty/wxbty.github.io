<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="description" content="回到梦开始的地方！">
    <title>meepo源码解析系列(五)之项目实战 | 飞过海</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0">
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
</head>
<body>
<div class="body_container">
    <div id="header">
        <div class="site-name"><h1 class="hidden">meepo源码解析系列(五)之项目实战</h1><a id="logo" href="/.">飞过海</a>
            <p class="description">回到梦开始的地方！</p></div>
        <div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i
                class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i
                class="fa fa-rss"> 订阅</i></a></div>
    </div>
    <div id="layout" class="pure-g">
        <div class="pure-u-1 pure-u-md-3-4">
            <div class="content_container">
                <div class="post"><h1 class="post-title">meepo源码解析系列(五)之项目实战</h1>
                    <div class="post-meta">Oct 12, 2017<span> | </span><span class="category"><a
                            href="/categories/meepo/">meepo</a></span></div>
                    <div class="post-content"><h4 id="接上一篇，我们已经分析了在整个消费的调用流程，现在只差发起真实的rpc远端调用了，这篇文章，我们一起进入提供者的调用流程吧！"><a
                            href="#接上一篇，我们已经分析了在整个消费的调用流程，现在只差发起真实的rpc远端调用了，这篇文章，我们一起进入提供者的调用流程吧！" class="headerlink"
                            title="接上一篇，我们已经分析了在整个消费的调用流程，现在只差发起真实的rpc远端调用了，这篇文章，我们一起进入提供者的调用流程吧！"></a>接上一篇，我们已经分析了在整个消费的调用流程，现在只差发起真实的rpc远端调用了，这篇文章，我们一起进入提供者的调用流程吧！
                    </h4>
                        <ul>
                            <li>我们发起 <strong>accountService.payment(accountDTO);</strong>
                                的调用，在提供方，我们可以看到其实现类为AccountServiceImpl:
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div><div
                                                class="line">24</div><div class="line">25</div><div
                                                class="line">26</div><div class="line">27</div><div
                                                class="line">28</div><div class="line">29</div><div
                                                class="line">30</div><div class="line">31</div><div
                                                class="line">32</div><div class="line">33</div><div
                                                class="line">34</div><div class="line">35</div><div
                                                class="line">36</div><div class="line">37</div><div
                                                class="line">38</div><div class="line">39</div><div
                                                class="line">40</div><div class="line">41</div><div
                                                class="line">42</div><div class="line">43</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div
                                                class="line"><span class="comment">    * 扣款支付</span></div><div
                                                class="line"><span class="comment">    *</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@param</span> accountDTO 参数dto</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@return</span> true</span></div><div class="line"><span
                                                class="comment">    */</span></div><div class="line">   <span
                                                class="meta">@Override</span></div><div class="line">   <span
                                                class="meta">@Tcc</span>(confirmMethod = <span
                                                class="string">"confirm"</span>, cancelMethod = <span class="string">"cancel"</span>)</div><div
                                                class="line">   <span class="function"><span
                                                class="keyword">public</span> <span class="keyword">boolean</span> <span
                                                class="title">payment</span><span
                                                class="params">(AccountDTO accountDTO)</span> </span>&#123;</div><div
                                                class="line">       <span class="keyword">final</span> AccountDO accountDO = accountMapper.findByUserId(accountDTO.getUserId());</div><div
                                                class="line">       accountDO.setBalance(accountDO.getBalance().subtract(accountDTO.getAmount()));</div><div
                                                class="line">       accountDO.setFreezeAmount(accountDO.getFreezeAmount().add(accountDTO.getAmount()));</div><div
                                                class="line">       accountDO.setUpdateTime(<span
                                                class="keyword">new</span> Date());</div><div class="line">       <span
                                                class="keyword">final</span> <span class="keyword">int</span> update = accountMapper.update(accountDO);</div><div
                                                class="line">       <span class="keyword">if</span> (update != <span
                                                class="number">1</span>) &#123;</div><div class="line">           <span
                                                class="keyword">throw</span> <span class="keyword">new</span> TccRuntimeException(<span
                                                class="string">"资金不足！"</span>);</div><div
                                                class="line">       &#125;</div><div class="line">       <span
                                                class="keyword">return</span> Boolean.TRUE;</div><div class="line">   &#125;</div><div
                                                class="line"></div><div class="line">   <span class="function"><span
                                                class="keyword">public</span> <span class="keyword">boolean</span> <span
                                                class="title">confirm</span><span
                                                class="params">(AccountDTO accountDTO)</span> </span>&#123;</div><div
                                                class="line"></div><div class="line">       LOGGER.debug(<span
                                                class="string">"============执行确认付款接口==============="</span>);</div><div
                                                class="line"></div><div class="line">       <span
                                                class="keyword">final</span> AccountDO accountDO = accountMapper.findByUserId(accountDTO.getUserId());</div><div
                                                class="line">       accountDO.setFreezeAmount(accountDO.getFreezeAmount().subtract(accountDTO.getAmount()));</div><div
                                                class="line">       accountDO.setUpdateTime(<span
                                                class="keyword">new</span> Date());</div><div class="line">       accountMapper.update(accountDO);</div><div
                                                class="line">       <span
                                                class="keyword">return</span> Boolean.TRUE;</div><div class="line">   &#125;</div><div
                                                class="line"></div><div class="line"></div><div class="line">   <span
                                                class="function"><span class="keyword">public</span> <span
                                                class="keyword">boolean</span> <span class="title">cancel</span><span
                                                class="params">(AccountDTO accountDTO)</span> </span>&#123;</div><div
                                                class="line"></div><div class="line">       LOGGER.debug(<span
                                                class="string">"============执行取消付款接口==============="</span>);</div><div
                                                class="line">       <span class="keyword">final</span> AccountDO accountDO = accountMapper.findByUserId(accountDTO.getUserId());</div><div
                                                class="line">       accountDO.setBalance(accountDO.getBalance().add(accountDTO.getAmount()));</div><div
                                                class="line">       accountDO.setFreezeAmount(accountDO.getFreezeAmount().subtract(accountDTO.getAmount()));</div><div
                                                class="line">       accountDO.setUpdateTime(<span
                                                class="keyword">new</span> Date());</div><div class="line">       accountMapper.update(accountDO);</div><div
                                                class="line">       <span
                                                class="keyword">return</span> Boolean.TRUE;</div><div class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li><p>我们发现它也有@Tcc注解，并且提供了confrim，cancel等真实的方法。通过前面一篇的分析，我们知道，他是springBean的一个实现类，同样会走切面。</p>
                            </li>
                            <li><p>经过 <strong>TccTransactionFactoryServiceImpl</strong> 的 factoryOf方法，我们可以知道他会返回
                                <strong>ProviderTccTransactionHandler</strong></p>
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="meta">@Override</span></div><div
                                                class="line">   <span class="function"><span
                                                class="keyword">public</span> Class <span class="title">factoryOf</span><span
                                                class="params">(TccTransactionContext context)</span> <span
                                                class="keyword">throws</span> Throwable </span>&#123;</div><div
                                                class="line"></div><div class="line">       <span class="comment">//如果事务还没开启或者 tcc事务上下文是空， 那么应该进入发起调用</span></div><div
                                                class="line">       <span class="keyword">if</span> (!tccTransactionManager.isBegin() &amp;&amp; Objects.isNull(context)) &#123;</div><div
                                                class="line">           <span class="keyword">return</span> StartTccTransactionHandler.class;</div><div
                                                class="line">       &#125; <span class="keyword">else</span> <span
                                                class="keyword">if</span> (tccTransactionManager.isBegin() &amp;&amp; Objects.isNull(context)) &#123;</div><div
                                                class="line">           <span class="keyword">return</span> ConsumeTccTransactionIHandler.class;</div><div
                                                class="line">       &#125; <span class="keyword">else</span> <span
                                                class="keyword">if</span> (Objects.nonNull(context)) &#123;</div><div
                                                class="line">           <span class="keyword">return</span> ProviderTccTransactionHandler.class;</div><div
                                                class="line">       &#125;</div><div class="line">       <span
                                                class="keyword">return</span> ConsumeTccTransactionIHandler.class;</div><div
                                                class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>最终我们来到 <strong>ProviderTccTransactionHandler.handler</strong> 方法：</li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div><div
                                                class="line">24</div><div class="line">25</div><div
                                                class="line">26</div><div class="line">27</div><div
                                                class="line">28</div><div class="line">29</div><div
                                                class="line">30</div><div class="line">31</div><div
                                                class="line">32</div><div class="line">33</div><div
                                                class="line">34</div><div class="line">35</div><div
                                                class="line">36</div><div class="line">37</div><div
                                                class="line">38</div><div class="line">39</div><div
                                                class="line">40</div><div class="line">41</div><div
                                                class="line">42</div><div class="line">43</div><div
                                                class="line">44</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="comment">/**</span></div><div
                                                class="line"><span class="comment">    * 分布式事务提供者处理接口</span></div><div
                                                class="line"><span
                                                class="comment">    * 根据tcc事务上下文的状态来执行相对应的方法</span></div><div
                                                class="line"><span class="comment">    *</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@param</span> point   point 切点</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@param</span> context context</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@return</span> Object</span></div><div class="line"><span
                                                class="comment">    * <span
                                                class="doctag">@throws</span> Throwable 异常</span></div><div
                                                class="line"><span class="comment">    */</span></div><div class="line">   <span
                                                class="meta">@Override</span></div><div class="line">   <span
                                                class="function"><span class="keyword">public</span> Object <span
                                                class="title">handler</span><span class="params">(ProceedingJoinPoint point, TccTransactionContext context)</span> <span
                                                class="keyword">throws</span> Throwable </span>&#123;</div><div
                                                class="line">       TccTransaction tccTransaction = <span
                                                class="keyword">null</span>;</div><div class="line">       <span
                                                class="keyword">try</span> &#123;</div><div
                                                class="line">           <span class="keyword">switch</span> (TccActionEnum.acquireByCode(context.getAction())) &#123;</div><div
                                                class="line">               <span
                                                class="keyword">case</span> TRYING:</div><div class="line">                   <span
                                                class="keyword">try</span> &#123;</div><div class="line">                       <span
                                                class="comment">//创建事务信息</span></div><div class="line">                       tccTransaction = tccTransactionManager.providerBegin(context);</div><div
                                                class="line">                       <span
                                                class="comment">//发起方法调用</span></div><div class="line">                       <span
                                                class="keyword">return</span> point.proceed();</div><div class="line">                   &#125; <span
                                                class="keyword">catch</span> (Throwable throwable) &#123;</div><div
                                                class="line">                       tccTransactionManager.removeTccTransaction(tccTransaction);</div><div
                                                class="line">                       <span class="keyword">throw</span> throwable;</div><div
                                                class="line"></div><div class="line">                   &#125;</div><div
                                                class="line">               <span class="keyword">case</span> CONFIRMING:</div><div
                                                class="line">                   <span class="comment">//如果是confirm 通过之前保存的事务信息 进行反射调用</span></div><div
                                                class="line">                   <span class="keyword">final</span> TccTransaction acquire = tccTransactionManager.acquire(context);</div><div
                                                class="line">                   tccTransactionManager.confirm();</div><div
                                                class="line">                   <span
                                                class="keyword">break</span>;</div><div
                                                class="line">               <span class="keyword">case</span> CANCELING:</div><div
                                                class="line">                   <span class="comment">//如果是调用CANCELING 通过之前保存的事务信息 进行反射调用</span></div><div
                                                class="line">                   tccTransactionManager.acquire(context);</div><div
                                                class="line">                   tccTransactionManager.cancel();</div><div
                                                class="line">                   <span
                                                class="keyword">break</span>;</div><div
                                                class="line">               <span class="keyword">default</span>:</div><div
                                                class="line">                   <span
                                                class="keyword">break</span>;</div><div
                                                class="line">           &#125;</div><div
                                                class="line">       &#125; <span
                                                class="keyword">finally</span> &#123;</div><div class="line">           tccTransactionManager.remove();</div><div
                                                class="line">       &#125;</div><div class="line">       Method method = ((MethodSignature) (point.getSignature())).getMethod();</div><div
                                                class="line">       <span class="keyword">return</span> getDefaultValue(method.getReturnType());</div><div
                                                class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li><strong>TccTransactionContext</strong> 就是通过rpc json序列化后传过来的对象，此时我们知道是在try阶段，所以我们进入try
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="keyword">try</span> &#123;</div><div
                                                class="line">    <span class="comment">//创建事务信息</span></div><div
                                                class="line">    tccTransaction = tccTransactionManager.providerBegin(context);</div><div
                                                class="line">    <span class="comment">//发起方法调用</span></div><div
                                                class="line">    <span
                                                class="keyword">return</span> point.proceed();</div><div class="line">&#125; <span
                                                class="keyword">catch</span> (Throwable throwable) &#123;</div><div
                                                class="line">    tccTransactionManager.removeTccTransaction(tccTransaction);</div><div
                                                class="line">    <span class="keyword">throw</span> throwable;</div><div
                                                class="line"></div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>首先我们会创建提供者的事务信息，并把他存起来，再把它存入threadlocal中，接着发起 <strong>point.proceed()</strong>
                                调用的时候，我们会进入<br><strong>TccCoordinatorMethodAspect</strong>,由于是在try阶段最终会进入：
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div><div
                                                class="line">24</div><div class="line">25</div><div
                                                class="line">26</div><div class="line">27</div><div
                                                class="line">28</div><div class="line">29</div><div
                                                class="line">30</div><div class="line">31</div><div
                                                class="line">32</div><div class="line">33</div><div
                                                class="line">34</div><div class="line">35</div><div
                                                class="line">36</div><div class="line">37</div><div
                                                class="line">38</div><div class="line">39</div><div
                                                class="line">40</div><div class="line">41</div><div
                                                class="line">42</div><div class="line">43</div><div
                                                class="line">44</div><div class="line">45</div><div
                                                class="line">46</div><div class="line">47</div><div
                                                class="line">48</div><div class="line">49</div><div
                                                class="line">50</div><div class="line">51</div><div
                                                class="line">52</div><div class="line">53</div><div
                                                class="line">54</div><div class="line">55</div><div
                                                class="line">56</div><div class="line">57</div><div
                                                class="line">58</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="comment">/**</span></div><div
                                                class="line"><span class="comment">    * 获取调用接口的协调方法并封装</span></div><div
                                                class="line"><span class="comment">    *</span></div><div
                                                class="line"><span class="comment">    * <span
                                                class="doctag">@param</span> point 切点</span></div><div
                                                class="line"><span class="comment">    */</span></div><div class="line">   <span
                                                class="function"><span class="keyword">private</span> <span
                                                class="keyword">void</span> <span
                                                class="title">registerParticipant</span><span class="params">(ProceedingJoinPoint point, String transId)</span> <span
                                                class="keyword">throws</span> NoSuchMethodException </span>&#123;</div><div
                                                class="line"></div><div class="line">       MethodSignature signature = (MethodSignature) point.getSignature();</div><div
                                                class="line">       Method method = signature.getMethod();</div><div
                                                class="line"></div><div class="line">       Class&lt;?&gt; clazz = point.getTarget().getClass();</div><div
                                                class="line"></div><div class="line">       Object[] args = point.getArgs();</div><div
                                                class="line"></div><div class="line">       <span
                                                class="keyword">final</span> Tcc tcc = method.getAnnotation(Tcc.class);</div><div
                                                class="line"></div><div class="line">       <span class="comment">//获取协调方法</span></div><div
                                                class="line">       String confirmMethodName = tcc.confirmMethod();</div><div
                                                class="line"></div><div class="line">      <span class="comment">/* if (StringUtils.isBlank(confirmMethodName)) &#123;</span></div><div
                                                class="line"><span class="comment">           confirmMethodName = method.getName();</span></div><div
                                                class="line"><span class="comment">       &#125;*/</span></div><div
                                                class="line"></div><div class="line">       String cancelMethodName = tcc.cancelMethod();</div><div
                                                class="line"></div><div class="line">      <span class="comment">/* if (StringUtils.isBlank(cancelMethodName)) &#123;</span></div><div
                                                class="line"><span class="comment">           cancelMethodName = method.getName();</span></div><div
                                                class="line"><span class="comment">       &#125;</span></div><div
                                                class="line"><span class="comment">*/</span></div><div class="line">       <span
                                                class="comment">//设置模式</span></div><div class="line">       <span
                                                class="keyword">final</span> TccPatternEnum pattern = tcc.pattern();</div><div
                                                class="line"></div><div class="line">       tccTransactionManager.getCurrentTransaction().setPattern(pattern.getCode());</div><div
                                                class="line"></div><div class="line"></div><div class="line">       TccInvocation confirmInvocation = <span
                                                class="keyword">null</span>;</div><div class="line">       <span
                                                class="keyword">if</span> (StringUtils.isNoneBlank(confirmMethodName)) &#123;</div><div
                                                class="line">           confirmInvocation = <span
                                                class="keyword">new</span> TccInvocation(clazz,</div><div class="line">                   confirmMethodName, method.getParameterTypes(), args);</div><div
                                                class="line">       &#125;</div><div class="line"></div><div
                                                class="line">       TccInvocation cancelInvocation = <span
                                                class="keyword">null</span>;</div><div class="line">       <span
                                                class="keyword">if</span> (StringUtils.isNoneBlank(cancelMethodName)) &#123;</div><div
                                                class="line">           cancelInvocation = <span
                                                class="keyword">new</span> TccInvocation(clazz,</div><div class="line">                   cancelMethodName,</div><div
                                                class="line">                   method.getParameterTypes(), args);</div><div
                                                class="line">       &#125;</div><div class="line"></div><div
                                                class="line"></div><div class="line">       <span class="comment">//封装调用点</span></div><div
                                                class="line">       <span class="keyword">final</span> Participant participant = <span
                                                class="keyword">new</span> Participant(</div><div class="line">               transId,</div><div
                                                class="line">               confirmInvocation,</div><div class="line">               cancelInvocation);</div><div
                                                class="line"></div><div class="line">       tccTransactionManager.enlistParticipant(participant);</div><div
                                                class="line"></div><div class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>这里获取真实的confrim，cancel方法并存入当前的事务信息中。然后发起真实的业务调用 ，即执行payment方法：</li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"></div><div class="line">  <span
                                                class="meta">@Override</span></div><div class="line">  <span
                                                class="meta">@Tcc</span>(confirmMethod = <span
                                                class="string">"confirm"</span>, cancelMethod = <span class="string">"cancel"</span>)</div><div
                                                class="line">  <span class="function"><span
                                                class="keyword">public</span> <span class="keyword">boolean</span> <span
                                                class="title">payment</span><span
                                                class="params">(AccountDTO accountDTO)</span> </span>&#123;</div><div
                                                class="line">      <span class="keyword">final</span> AccountDO accountDO = accountMapper.findByUserId(accountDTO.getUserId());</div><div
                                                class="line">      accountDO.setBalance(accountDO.getBalance().subtract(accountDTO.getAmount()));</div><div
                                                class="line">      accountDO.setFreezeAmount(accountDO.getFreezeAmount().add(accountDTO.getAmount()));</div><div
                                                class="line">      accountDO.setUpdateTime(<span
                                                class="keyword">new</span> Date());</div><div class="line">      <span
                                                class="keyword">final</span> <span class="keyword">int</span> update = accountMapper.update(accountDO);</div><div
                                                class="line">      <span class="keyword">if</span> (update != <span
                                                class="number">1</span>) &#123;</div><div class="line">          <span
                                                class="keyword">throw</span> <span class="keyword">new</span> TccRuntimeException(<span
                                                class="string">"资金不足！"</span>);</div><div
                                                class="line">      &#125;</div><div class="line">      <span
                                                class="keyword">return</span> Boolean.TRUE;</div><div class="line">  &#125;</div><div
                                                class="line"></div><div class="line">`</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>当我们执行完该方法后，会返回，还记得我是在哪里来执行这个方法的吗？对，当然是切面，我们是在切面里执行的，我们是在<br><strong>PaymentServiceImpl.makePayment</strong>
                                切面里面执行的！ 请要理解这一点，执行完后，我们发起了 <strong>inventoryService.decrease(inventoryDTO)</strong>
                                调用<br>他的调用原理和上面一模一样，只是在不同的模块里面执行。当 <strong>makePayment</strong> 方法执行完后，我们该怎么执行？ 你还记得
                                StartTccTransactionHandler吗，它可一直在那等呢。。<br>我们再来回顾下他的代码:
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="meta">@Override</span></div><div
                                                class="line">   <span class="function"><span
                                                class="keyword">public</span> Object <span
                                                class="title">handler</span><span class="params">(ProceedingJoinPoint point, TccTransactionContext context)</span> <span
                                                class="keyword">throws</span> Throwable </span>&#123;</div><div
                                                class="line">       Object returnValue;</div><div
                                                class="line">       <span class="keyword">try</span> &#123;</div><div
                                                class="line">           tccTransactionManager.begin();</div><div
                                                class="line">           <span class="keyword">try</span> &#123;</div><div
                                                class="line">               <span class="comment">//发起调用 执行try方法</span></div><div
                                                class="line">               returnValue = point.proceed();</div><div
                                                class="line"></div><div class="line">           &#125; <span
                                                class="keyword">catch</span> (Throwable throwable) &#123;</div><div
                                                class="line">               <span
                                                class="comment">//异常执行cancel</span></div><div class="line"></div><div
                                                class="line">               tccTransactionManager.cancel();</div><div
                                                class="line"></div><div class="line">               <span
                                                class="keyword">throw</span> throwable;</div><div class="line">           &#125;</div><div
                                                class="line">           <span class="comment">//try成功执行confirm confirm 失败的话，那就只能走本地补偿</span></div><div
                                                class="line">           tccTransactionManager.confirm();</div><div
                                                class="line">       &#125; <span
                                                class="keyword">finally</span> &#123;</div><div class="line">           tccTransactionManager.remove();</div><div
                                                class="line">       &#125;</div><div class="line">       <span
                                                class="keyword">return</span> returnValue;</div><div class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>说到底，我们走了这么久，其实到这里，我们才执行完 <strong>returnValue = point.proceed();</strong> 这一句代码。</li>
                        </ul>
                        <h4 id="没有异常"><a href="#没有异常" class="headerlink" title="没有异常"></a>没有异常</h4>
                        <ul>
                            <li>我们会执行 <strong>tccTransactionManager.confirm();</strong> 我们跟进去看代码:</li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div><div
                                                class="line">24</div><div class="line">25</div><div
                                                class="line">26</div><div class="line">27</div><div
                                                class="line">28</div><div class="line">29</div><div
                                                class="line">30</div><div class="line">31</div><div
                                                class="line">32</div><div class="line">33</div><div
                                                class="line">34</div><div class="line">35</div><div
                                                class="line">36</div><div class="line">37</div><div
                                                class="line">38</div><div class="line">39</div><div
                                                class="line">40</div><div class="line">41</div><div
                                                class="line">42</div><div class="line">43</div><div
                                                class="line">44</div><div class="line">45</div><div
                                                class="line">46</div><div class="line">47</div><div
                                                class="line">48</div><div class="line">49</div><div
                                                class="line">50</div><div class="line">51</div><div
                                                class="line">52</div><div class="line">53</div><div
                                                class="line">54</div><div class="line">55</div><div
                                                class="line">56</div><div class="line">57</div><div
                                                class="line">58</div><div class="line">59</div><div
                                                class="line">60</div><div class="line">61</div><div
                                                class="line">62</div><div class="line">63</div><div
                                                class="line">64</div><div class="line">65</div><div
                                                class="line">66</div><div class="line">67</div><div
                                                class="line">68</div><div class="line">69</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="comment">/**</span></div><div
                                                class="line"><span class="comment">     * 调用confirm方法 这里主要如果是发起者调用 这里调用远端的还是原来的方法，不过上下文设置了调用confirm</span></div><div
                                                class="line"><span class="comment">     * 那么远端的服务则会调用confirm方法。。</span></div><div
                                                class="line"><span class="comment">     */</span></div><div
                                                class="line">    <span class="function"><span
                                                class="keyword">void</span> <span class="title">confirm</span><span
                                                class="params">()</span> <span class="keyword">throws</span> TccRuntimeException </span>&#123;</div><div
                                                class="line"></div><div class="line">        LogUtil.debug(LOGGER, () -&gt; <span
                                                class="string">"开始执行tcc confirm 方法！start"</span>);</div><div
                                                class="line"></div><div class="line">        <span
                                                class="keyword">final</span> TccTransaction currentTransaction = getCurrentTransaction();</div><div
                                                class="line"></div><div class="line">        <span
                                                class="keyword">if</span> (Objects.isNull(currentTransaction)) &#123;</div><div
                                                class="line">            <span class="keyword">return</span>;</div><div
                                                class="line">        &#125;</div><div class="line"></div><div
                                                class="line">        currentTransaction.setStatus(TccActionEnum.CONFIRMING.getCode());</div><div
                                                class="line"></div><div class="line">        coordinatorCommand.execute(<span
                                                class="keyword">new</span> CoordinatorAction(CoordinatorActionEnum.UPDATE, currentTransaction));</div><div
                                                class="line"></div><div class="line">        <span
                                                class="keyword">final</span> List&lt;Participant&gt; participants = currentTransaction.getParticipants();</div><div
                                                class="line">        List&lt;Participant&gt; participantList = Lists.newArrayListWithCapacity(participants.size());</div><div
                                                class="line">        <span
                                                class="keyword">boolean</span> success = <span
                                                class="keyword">true</span>;</div><div class="line">        Participant fail = <span
                                                class="keyword">null</span>;</div><div class="line">        <span
                                                class="keyword">if</span> (CollectionUtils.isNotEmpty(participants)) &#123;</div><div
                                                class="line">            <span class="keyword">for</span> (Participant participant : participants) &#123;</div><div
                                                class="line">                <span
                                                class="keyword">try</span> &#123;</div><div class="line">                    TccTransactionContext context = <span
                                                class="keyword">new</span> TccTransactionContext();</div><div
                                                class="line">                    context.setAction(TccActionEnum.CONFIRMING.getCode());</div><div
                                                class="line">                    context.setTransId(participant.getTransId());</div><div
                                                class="line">                    TransactionContextLocal.getInstance().set(context);</div><div
                                                class="line">                    <span class="comment">//通过反射调用rpc的confrim方法</span></div><div
                                                class="line">                    executeParticipantMethod(participant.getConfirmTccInvocation());</div><div
                                                class="line">                    participantList.add(participant);</div><div
                                                class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div
                                                class="line">                    LogUtil.error(LOGGER, <span
                                                class="string">"执行confirm方法异常:&#123;&#125;"</span>, () -&gt; e);</div><div
                                                class="line">                    success = <span
                                                class="keyword">false</span>;</div><div class="line">                    fail = participant;</div><div
                                                class="line">                    <span
                                                class="keyword">break</span>;</div><div class="line">                &#125;</div><div
                                                class="line">            &#125;</div><div
                                                class="line">        &#125;</div><div class="line">        executeHandler(success, currentTransaction, fail, participantList, participants);</div><div
                                                class="line">    &#125;</div><div class="line">    <span
                                                class="function"><span class="keyword">private</span> <span
                                                class="keyword">void</span> <span
                                                class="title">executeHandler</span><span class="params">(<span
                                                class="keyword">boolean</span> success, <span
                                                class="keyword">final</span> TccTransaction currentTransaction, Participant fail,</span></span></div><div
                                                class="line"><span class="function"><span class="params">                                List&lt;Participant&gt; participantList, <span
                                                class="keyword">final</span> List&lt;Participant&gt; participants)</span> </span>&#123;</div><div
                                                class="line">        <span
                                                class="keyword">if</span> (success) &#123;</div><div class="line">            TransactionContextLocal.getInstance().remove();</div><div
                                                class="line">            coordinatorCommand.execute(<span
                                                class="keyword">new</span> CoordinatorAction(CoordinatorActionEnum.DELETE, currentTransaction));</div><div
                                                class="line">        &#125; <span
                                                class="keyword">else</span> &#123;</div><div
                                                class="line">            <span class="comment">//获取还没执行的，或者执行失败的</span></div><div
                                                class="line">            <span class="keyword">final</span> List&lt;Participant&gt; updateList =</div><div
                                                class="line">                    participants.stream().skip(participantList.size()).collect(Collectors.toList());</div><div
                                                class="line">            currentTransaction.setParticipants(updateList);</div><div
                                                class="line">            coordinatorCommand.execute(<span
                                                class="keyword">new</span> CoordinatorAction(CoordinatorActionEnum.UPDATE, currentTransaction));</div><div
                                                class="line">            <span
                                                class="keyword">assert</span> fail != <span class="keyword">null</span>;</div><div
                                                class="line">            <span class="keyword">throw</span> <span
                                                class="keyword">new</span> TccRuntimeException(fail.getConfirmTccInvocation().toString());</div><div
                                                class="line">        &#125;</div><div class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span class="function"><span
                                                class="keyword">private</span> <span class="keyword">void</span> <span
                                                class="title">executeParticipantMethod</span><span class="params">(TccInvocation tccInvocation)</span> <span
                                                class="keyword">throws</span> Exception </span>&#123;</div><div
                                                class="line">       <span class="keyword">if</span> (Objects.nonNull(tccInvocation)) &#123;</div><div
                                                class="line">           <span class="keyword">final</span> Class clazz = tccInvocation.getTargetClass();</div><div
                                                class="line">           <span class="keyword">final</span> String method = tccInvocation.getMethodName();</div><div
                                                class="line">           <span class="keyword">final</span> Object[] args = tccInvocation.getArgs();</div><div
                                                class="line">           <span class="keyword">final</span> Class[] parameterTypes = tccInvocation.getParameterTypes();</div><div
                                                class="line">           <span class="keyword">final</span> Object bean = SpringBeanUtils.getInstance().getBean(clazz);</div><div
                                                class="line">           MethodUtils.invokeMethod(bean, method, args, parameterTypes);</div><div
                                                class="line"></div><div class="line">       &#125;</div><div
                                                class="line">   &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li><p>这段代码的逻辑，简单理解起来，首先更新当前事务状态（confrim），获取当前事务的调用点的confrim方法，设置上下文，发起反射调用！</p>
                            </li>
                            <li><p>其实这里通过调试我们发现，发起confrim的方法为 <strong>AccountService.payment(AccountDTO
                                accountDTO)</strong> ，不过设置的上下文状态为confrim,<br>当我们发起反射调用的时候，我们会走到 <strong>ProviderTccTransactionHandler.handler</strong>
                                方法,这个方法或许你还有印象，我们再看一下它的代码:</p>
                            </li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div><div class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div class="line">9</div><div
                                                class="line">10</div><div class="line">11</div><div
                                                class="line">12</div><div class="line">13</div><div
                                                class="line">14</div><div class="line">15</div><div
                                                class="line">16</div><div class="line">17</div><div
                                                class="line">18</div><div class="line">19</div><div
                                                class="line">20</div><div class="line">21</div><div
                                                class="line">22</div><div class="line">23</div><div
                                                class="line">24</div><div class="line">25</div><div
                                                class="line">26</div><div class="line">27</div><div
                                                class="line">28</div><div class="line">29</div><div
                                                class="line">30</div><div class="line">31</div><div
                                                class="line">32</div><div class="line">33</div><div
                                                class="line">34</div><div class="line">35</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="meta">@Override</span></div><div
                                                class="line">    <span class="function"><span
                                                class="keyword">public</span> Object <span
                                                class="title">handler</span><span class="params">(ProceedingJoinPoint point, TccTransactionContext context)</span> <span
                                                class="keyword">throws</span> Throwable </span>&#123;</div><div
                                                class="line">        TccTransaction tccTransaction = <span
                                                class="keyword">null</span>;</div><div class="line">        <span
                                                class="keyword">try</span> &#123;</div><div
                                                class="line">            <span class="keyword">switch</span> (TccActionEnum.acquireByCode(context.getAction())) &#123;</div><div
                                                class="line">                <span
                                                class="keyword">case</span> TRYING:</div><div class="line">                    <span
                                                class="keyword">try</span> &#123;</div><div class="line">                        <span
                                                class="comment">//创建事务信息</span></div><div class="line">                        tccTransaction = tccTransactionManager.providerBegin(context);</div><div
                                                class="line">                        <span
                                                class="comment">//发起方法调用</span></div><div class="line">                        <span
                                                class="keyword">return</span> point.proceed();</div><div class="line">                    &#125; <span
                                                class="keyword">catch</span> (Throwable throwable) &#123;</div><div
                                                class="line">                        tccTransactionManager.removeTccTransaction(tccTransaction);</div><div
                                                class="line">                        <span class="keyword">throw</span> throwable;</div><div
                                                class="line"></div><div class="line">                    &#125;</div><div
                                                class="line">                <span class="keyword">case</span> CONFIRMING:</div><div
                                                class="line">                    <span class="comment">//如果是confirm 通过之前保存的事务信息 进行反射调用</span></div><div
                                                class="line">                    <span class="keyword">final</span> TccTransaction acquire = tccTransactionManager.acquire(context);</div><div
                                                class="line">                    tccTransactionManager.confirm();</div><div
                                                class="line">                    <span
                                                class="keyword">break</span>;</div><div
                                                class="line">                <span class="keyword">case</span> CANCELING:</div><div
                                                class="line">                    <span class="comment">//如果是调用CANCELING 通过之前保存的事务信息 进行反射调用</span></div><div
                                                class="line">                    tccTransactionManager.acquire(context);</div><div
                                                class="line">                    tccTransactionManager.cancel();</div><div
                                                class="line">                    <span
                                                class="keyword">break</span>;</div><div
                                                class="line">                <span class="keyword">default</span>:</div><div
                                                class="line">                    <span
                                                class="keyword">break</span>;</div><div
                                                class="line">            &#125;</div><div
                                                class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div
                                                class="line">            tccTransactionManager.remove();</div><div
                                                class="line">        &#125;</div><div class="line">        Method method = ((MethodSignature) (point.getSignature())).getMethod();</div><div
                                                class="line">        <span class="keyword">return</span> getDefaultValue(method.getReturnType());</div><div
                                                class="line">    &#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li>这里因为上下文设置的状态为:CONFIRMING ,所以会执行:</li>
                        </ul>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div
                                                class="line">4</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span
                                                class="comment">//如果是confirm 通过之前保存的事务信息 进行反射调用</span></div><div
                                                class="line"><span class="keyword">final</span> TccTransaction acquire = tccTransactionManager.acquire(context);</div><div
                                                class="line">tccTransactionManager.confirm();</div><div
                                                class="line"><span class="keyword">break</span>;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                        <ul>
                            <li><p>我们跟踪 <strong>tccTransactionManager.confirm();</strong>
                                会发现和之前是一个方法，这时候，你要知道，这个方法是在account微服务里面执行</p>
                            </li>
                            <li><p>所以它最后会执行 <strong>AccountServiceImpl.confirm</strong> 方法，进行了付款确认。</p>
                            </li>
                        </ul>
                        <h3 id="同理cancel方法也和上面描述的一样的原理执行。"><a href="#同理cancel方法也和上面描述的一样的原理执行。" class="headerlink"
                                                              title="同理cancel方法也和上面描述的一样的原理执行。"></a>同理cancel方法也和上面描述的一样的原理执行。
                        </h3>
                        <h2 id="到这里，我们就解析完了，整个tcc过程执行的流程，大家关键要理解AOP，理解好了切面思想，其实是很简单的事情了，如果有任何疑问和问题，欢迎加入QQ群：162614487-进行讨论">
                            <a href="#到这里，我们就解析完了，整个tcc过程执行的流程，大家关键要理解AOP，理解好了切面思想，其实是很简单的事情了，如果有任何疑问和问题，欢迎加入QQ群：162614487-进行讨论"
                               class="headerlink"
                               title="到这里，我们就解析完了，整个tcc过程执行的流程，大家关键要理解AOP，理解好了切面思想，其实是很简单的事情了，如果有任何疑问和问题，欢迎加入QQ群：162614487 进行讨论"></a>到这里，我们就解析完了，整个tcc过程执行的流程，大家关键要理解AOP，理解好了切面思想，其实是很简单的事情了，如果有任何疑问和问题，欢迎加入QQ群：162614487
                            进行讨论</h2></div>
                    <div class="tags"></div>
                    <div class="post-nav"><a href="/2018/08/04/base/one/"
                                             class="pre">meepo源码解析系列(三)之框架架构</a><a
                            href="/2018/08/04/base/two/" class="next">meepo源码解析系列(四)之项目实战</a></div>
                </div>
            </div>
        </div>
        <div class="pure-u-1-4 hidden_mid_and_down">
            <div id="sidebar">
                <div class="widget">
                    <form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"
                          class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input
                            type="hidden" name="sitesearch" value="http://wxbty.github.io"/></form>
                </div>
                <div class="widget">
                    <div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div>
                    <ul class="category-list">
                        <li class="category-list-item"><a class="category-list-link"
                                                          href="/categories/Raincat/">Raincat</a><span
                                class="category-list-count">3</span></li>
                        <li class="category-list-item"><a class="category-list-link" href="/categories/meepo/">meepo</a><span
                                class="category-list-count">6</span></li>
                    </ul>
                </div>
                <div class="widget">
                    <div class="widget-title"><i class="fa fa-star-o"> 标签</i></div>
                    <div class="tagcloud"></div>
                </div>
                <div class="widget">
                    <div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div>
                    <ul class="post-list">
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/01/start/two/">meepo源码解析系列(二)之环境搭建</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/14/tx/tx-seven/">meepo源码解析系列之transaction-admin
                            事务跟踪查看管理后台</a></li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/01/start/one/">meepo源码解析系列(一)之项目结构</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/04/base/one/">meepo源码解析系列(三)之框架架构</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/04/base/tcc-five/">meepo源码解析系列(五)之项目实战</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/04/base/two/">meepo源码解析系列(四)之项目实战</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/04/base/one/">meepo源码解析系列(三)之启动详解</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/01/start/two/">meepo源码解析系列(二)之环境搭建</a>
                        </li>
                        <li class="post-list-item"><a class="post-list-link" href="/2018/08/01/start/one/">meepo源码解析系列(一)之项目结构</a>
                        </li>
                    </ul>
                </div>
                <div class="widget">
                    <div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div>
                    <ul></ul>
                    <a href="https://github.com/wxbty" title="GitHub" target="_blank">GitHub</a>
                    <ul></ul>
                    <a href="http://www.iocoder.cn/" title="芋道源码" target="_blank">芋道源码</a></div>
            </div>
        </div>
        <div class="pure-u-1 pure-u-md-3-4">
            <div id="footer">Copyright © 2018 <a href="/." rel="nofollow">飞过海.</a> Powered by<a rel="nofollow"
                                                                                                target="_blank"
                                                                                                href="https://hexo.io">
                Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a>
                by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div>
        </div>
    </div>
    <a id="rocket" href="#top" class="show"></a>
    <script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script>
    <script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script>
    <script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css">
    <script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script>
    <script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script>
</div>
</body>
</html>